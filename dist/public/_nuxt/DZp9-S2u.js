import{_ as ue}from"./Bz1yoids.js";import{_ as de}from"./CSISanO2.js";import{l as pe,R as fe,M as _e,P as I,E as R,S as ve,H as U,w as C,n as e,o as i,c as f,J as k,a as o,b as s,U as P,F as J,x as K,t as _,y as ge,r as ye,W as be,T as xe}from"./BCrY3s8v.js";import{_ as he}from"./BA4GzNlT.js";import{_ as De}from"./bl0oUpIY.js";import{_ as Ce}from"./CwNR5WVR.js";import{_ as we}from"./CidxsHgk.js";import{_ as Ie,a as ke}from"./Bkd0wxOE.js";import{_ as $e}from"./A1aqh1bs.js";import{_ as Ae}from"./CqYo-uwL.js";import{_ as Ue}from"./RTrhuSk4.js";import{t as M}from"./-7KF7Ksm.js";import{t as $}from"./ChRclvJ-.js";import{z as T}from"./BoqIIjWt.js";import{n as Ve}from"./wc51SthY.js";import{u as O}from"./CAqHKxSD.js";import{r as Se,u as Ne}from"./Dsaz7ZGA.js";import"./DGxpg-Ox.js";import"./1c9ch5oL.js";import"./CpLtEdiG.js";import"./8tY1C0Fy.js";import"./CHIgUVhi.js";import"./Bar4WUZu.js";import"./jFYhBC76.js";import"./CZ2Yaa7T.js";import"./D8mweQSH.js";import"./Df43cr2Y.js";import"./IDdVFqQ_.js";import"./BsY6ekDi.js";import"./DSCz-RR9.js";const Be=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),W={randomUUID:Be};function Fe(c,d,m){if(W.randomUUID&&!c)return W.randomUUID();c=c||{};const r=c.random??c.rng?.()??Se();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,Ne(r)}const Re=c=>{switch(c){case"forex":return"primary";case"stocks":return"success";case"real_estate":return"error";case"bonds":return"warning";case"derivatives":return"warning";case"cryptocurrencies":return"success";default:return"error"}};function Pe(c,d){return c.reduce((m,r)=>{const p=r[d];return m[p]||(m[p]=[]),m[p].push(r),m},{})}function Me(c,d,m="asc"){return[...c].sort((r,p)=>{const v=r[d],g=p[d];if(v===g)return 0;if(v==null)return 1;if(g==null)return-1;if(typeof v=="number"&&typeof g=="number")return m==="asc"?v-g:g-v;const V=String(v),S=String(g);return m==="asc"?V.localeCompare(S):S.localeCompare(V)})}const Ee={key:0},je={class:"flex items-center justify-end flex-wrap gap-x-4 gap-y-2"},ze={class:"space-y-1"},Te={class:"space-y-1"},Ge={class:"flex items-center gap-2"},Ye={key:0,class:"mt-4 space-y-12"},qe={class:"bg-muted py-1 px-2 rounded font-semibold text-primary mb-4"},Je={class:"grid grid-cols-[repeat(auto-fill,minmax(18rem,1fr))] gap-4"},Ke={class:"card-title"},Oe={class:"mt-2"},We={class:"font-geist-mono text-3xl font-semibold"},He={class:"space-y-4 mb-4 text-[0.9rem]"},Le={class:"flex items-center gap-2"},Xe={class:"font-semibold"},Qe={class:"flex items-center gap-2"},Ze={class:"font-semibold"},et={class:"flex items-center gap-2"},tt={class:"font-semibold"},ot={class:"flex items-center gap-2"},nt={class:"font-semibold"},st={key:1},at={key:0,class:"space-y-4"},lt={class:"text-center"},it={class:"text-lg font-geist-mono font-semibold"},rt={key:0,class:"flex-col-center gap-y-2"},ct={class:"font-geist-mono text-4xl font-medium"},mt={key:2,class:"flex-center"},ut={key:3},dt={class:"flex items-center justify-end gap-2"},qt=pe({__name:"index",async setup(c){let d,m;const r=fe(),{data:p,error:v,refresh:g}=([d,m]=_e(()=>O("/api/investment-plans",{key:"investment-plans"},"$WNjXhrCBSh")),d=await d,m(),d),V=[{label:"Category",value:"category"},{label:"Interest cycle",value:"profitDistribution"}],S=[{label:"Name",value:"name"},{label:"Duration",value:"duration"},{label:"Min. deposit",value:"minimumDeposit"},{label:"Max. deposit",value:"maximumDeposit"}],H=["asc","desc"],N=I("category"),B=I("minimumDeposit"),F=I("asc"),L=R(()=>{if(!p.value)return[];const n=Pe(p.value,N.value);return Object.entries(n).map(([y,h])=>({group:y,items:Me(h,B.value,F.value)}))}),{pending:X,data:E,error:Q,execute:G}=O("/api/user/financial-accounts",{key:"user-financial-accounts-non-immediate",immediate:!1},"$TMJY-tKtqI"),Z=R(()=>E.value?.financialAccounts?.map(n=>({label:n.name,value:n.id}))),A=I(!1),a=I(null),ee=n=>{a.value=n,A.value=!0,G()},te=R(()=>{const n=a.value?.minimumDeposit??0,t=a.value?.maximumDeposit??1e5;return T.object({accountId:T.string({message:"Select an account"}).nonempty({message:"Select an account"}),amount:T.number({message:"Amount is required"}).min(n,{message:`Amount must be at least ${$(n)}`}).max(t,{message:`Amount must be not be more than ${$(t)}`})})}),b=ve({accountId:"",amount:0}),oe=()=>{b.accountId="",b.amount=0},w=R(()=>E.value?.financialAccounts?.find(n=>b.accountId===n.id)),ne=()=>{a.value=null,oe(),A.value=!1},j=I(null),se=async n=>{const t=w.value?.primaryUser?.accountUserId;if(!t||!a.value)return;const{accountId:y,amount:h}=n.data;if(w.value.balance<h)return;const D={id:Fe(),financialAccountId:y,investorId:t,deposit:h,investmentName:a.value.name,totalProfit:0,profitCount:0,status:"open",category:a.value.category,duration:a.value.duration,daysCompleted:0,totalReturn:a.value.percentageTotalReturn,periodicReturn:a.value.percentagePeriodicReturn,profitDistribution:a.value.profitDistribution,terminationFee:a.value.terminationFee,closedAt:null,closedReason:null,pausedAt:null,pausedReason:null,terminatedAt:null,terminatedReason:null,createdAt:new Date,updatedAt:new Date};try{const{investment:x,message:z}=await $fetch(`/api/user/financial-accounts/${y}/investments`,{method:"post",body:D});r.add({color:"success",title:"Success",description:z}),await xe(`/user/accounts/${x.financialAccountId}/investments/${x.id}`)}catch(x){j.value=Ve(x)}};return(n,t)=>{const y=ue,h=de,D=ge,x=ye,z=he,ae=De,le=Ce,Y=we,q=ke,ie=$e,re=Ie,ce=Ae,me=Ue;return i(),U(me,{error:e(v),onRefresh:t[7]||(t[7]=l=>e(g)())},{default:C(()=>[e(p)?(i(),f("div",Ee,[o("header",je,[o("div",ze,[t[8]||(t[8]=o("p",{class:"text-right md:text-left text-xs font-semibold"},"Group by",-1)),s(y,{modelValue:e(N),"onUpdate:modelValue":t[0]||(t[0]=l=>P(N)?N.value=l:null),items:V,size:"sm",class:"w-28 md:w-32"},null,8,["modelValue"])]),o("div",Te,[t[9]||(t[9]=o("p",{class:"text-right md:text-left text-xs font-semibold"},"Sort by",-1)),o("div",Ge,[s(y,{modelValue:e(B),"onUpdate:modelValue":t[1]||(t[1]=l=>P(B)?B.value=l:null),items:S,size:"sm",class:"w-[7.5rem]"},null,8,["modelValue"]),s(y,{modelValue:e(F),"onUpdate:modelValue":t[2]||(t[2]=l=>P(F)?F.value=l:null),items:H,size:"sm",class:"w-[4.5rem]"},null,8,["modelValue"])])])]),e(p).length?(i(),f("div",Ye,[(i(!0),f(J,null,K(e(L),l=>(i(),f("div",{key:l.group},[o("header",qe,_(("toCase"in n?n.toCase:e(M))(l.group,"sentence")),1),o("div",Je,[(i(!0),f(J,null,K(l.items,u=>(i(),U(z,{key:u.id},{header:C(()=>[o("div",null,[o("div",null,[o("p",Ke,_(u.name),1),s(h,{variant:"soft",color:("getInvestmentPlanCategoryBadgeColor"in n?n.getInvestmentPlanCategoryBadgeColor:e(Re))(u.category),label:("toCase"in n?n.toCase:e(M))(u.category,"lower")},null,8,["color","label"])]),o("div",Oe,[o("p",We,_(("toDollar"in n?n.toDollar:e($))(u.minimumDeposit)),1),t[10]||(t[10]=o("p",{class:"text-sm"},"Minimum Deposit",-1))])])]),default:C(()=>[o("div",null,[o("ul",He,[o("li",Le,[s(D,{name:"lucide-circle-check"}),o("p",Xe,_(("toDollar"in n?n.toDollar:e($))(u.maximumDeposit)),1),t[11]||(t[11]=o("p",null,"maximum deposit",-1))]),o("li",Qe,[s(D,{name:"lucide-circle-check"}),o("p",Ze,_(u.duration),1),t[12]||(t[12]=o("p",null,"days term",-1))]),o("li",et,[s(D,{name:"lucide-circle-check"}),o("p",tt,_(u.percentagePeriodicReturn)+"% ",1),o("p",null,_(("toCase"in n?n.toCase:e(M))(u.profitDistribution,"lower"))+" interest ",1)]),o("li",ot,[s(D,{name:"lucide-circle-check"}),o("p",nt,_(u.percentageTotalReturn-100)+"% ",1),t[13]||(t[13]=o("p",null,"total return",-1))])]),s(x,{label:"Invest now",class:"w-full justify-center",onClick:pt=>ee(u)},null,8,["onClick"])])]),_:2},1024))),128))])]))),128))])):(i(),f("div",st,[s(ae,{label:"No investment plans"})])),s(ce,{open:e(A),"onUpdate:open":t[6]||(t[6]=l=>P(A)?A.value=l:null),title:`${("toCase"in n?n.toCase:e(M))(e(a)?.category??"unknown","sentence")}`,description:e(a)?.name,dismissible:!1},{body:C(()=>[e(a)?(i(),f("div",at,[o("div",lt,[t[14]||(t[14]=o("p",{class:"text-sm"},"Minimum deposit",-1)),o("p",it,_(("toDollar"in n?n.toDollar:e($))(e(a).minimumDeposit)),1)]),e(w)?(i(),f("div",rt,[o("p",ct,_(("toDollar"in n?n.toDollar:e($))(e(w).balance)),1),s(h,{color:"neutral",variant:"outline",label:"Account balance"}),e(w).balance<e(a).minimumDeposit?(i(),U(le,{key:0,color:"error",variant:"soft",description:"You do not have sufficient balance to complete this investment"})):k("",!0)])):k("",!0),e(j)?(i(),U(Y,{key:1,message:e(j).message},null,8,["message"])):k("",!0),e(X)?(i(),f("div",mt,[s(D,{name:"lucide-loader",size:"2rem",class:"animate animate-spin"})])):e(Q)?(i(),f("div",ut,[s(Y,{message:"Failed to get accounts","show-retry":"",onRetry:t[3]||(t[3]=l=>e(G)())})])):e(E)?(i(),U(re,{key:4,state:e(b),schema:e(te),class:"space-y-4",onSubmit:be(se,["prevent"])},{default:C(()=>[s(q,{name:"accountId",label:"Your accounts",description:"Select one of your accounts to continue with this investment",class:"w-full"},{default:C(()=>[s(y,{modelValue:e(b).accountId,"onUpdate:modelValue":t[4]||(t[4]=l=>e(b).accountId=l),items:e(Z),placeholder:"Select account",class:"w-full"},null,8,["modelValue","items"])]),_:1}),s(q,{name:"amount",label:"Deposit amount",class:"w-full"},{default:C(()=>[s(ie,{modelValue:e(b).amount,"onUpdate:modelValue":t[5]||(t[5]=l=>e(b).amount=l),"step-snapping":!1,min:e(a).minimumDeposit,max:e(w)?.balance,"format-options":{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2},class:"w-full"},null,8,["modelValue","min","max"])]),_:1}),o("div",dt,[s(x,{label:"Cancel",color:"neutral",variant:"soft",onClick:ne}),s(x,{type:"submit","loading-auto":"",label:"Invest"})])]),_:1},8,["state","schema"])):k("",!0)])):k("",!0)]),_:1},8,["open","title","description"])])):k("",!0)]),_:1},8,["error"])}}});export{qt as default};
