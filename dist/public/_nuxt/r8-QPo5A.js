import{l as M,M as S,E as H,P as $,H as R,o as b,w as o,b as t,n as e,U as P,c as W,J as V,a as m,r as Y,h as te,V as ne,S as ae,al as oe,am as se,W as le,R as re,N as I}from"./CVwvMgBG.js";import{_ as L}from"./V07vZcpm.js";import{_ as B}from"./BaciPMwD.js";import{_ as K}from"./B4p64Xk_.js";import{_ as O}from"./BQH4YRWo.js";import{n as j}from"./CftSbWNE.js";import{u as J}from"./CA--58-j.js";import{u as F}from"./BWylYwCy.js";import{t as T}from"./-7KF7Ksm.js";import{_ as ce}from"./C5cbwpr9.js";import{_ as Z}from"./BZPumJrv.js";import{_ as ue,a as X}from"./D7s51L10.js";import{_ as ie}from"./BGJXlsmp.js";import{_ as me}from"./B9XHDwWB.js";import{_ as de}from"./C-BGqY-V.js";import{a as pe}from"./C3npS8vC.js";import{J as _e}from"./Ct8ysQ5s.js";import"./mGNbPSyX.js";import"./C40-9aZM.js";import"./TnZ4cY_b.js";import"./CM2wjgdt.js";import"./D_ajDymQ.js";import"./Bgc-ZZWy.js";import"./CGTwjFam.js";import"./CSRlhb3z.js";import"./fF25g3x0.js";import"./CHIgUVhi.js";import"./jFYhBC76.js";import"./DKC2jaoI.js";import"./BvhMhgb1.js";import"./BeAYYLxY.js";const fe={key:0,class:"space-y-4"},ve={class:"flex items-center justify-end gap-2"},ye=M({__name:"current-users",async setup(C){let u,s;const x=J().getParams("accountId"),{pending:U,data:f,error:g,refresh:q}=([u,s]=S(()=>F(`/api/user/financial-accounts/${x}/account-users`,{key:"account-current-users"},"$I09Lj1pvkj")),u=await u,s(),u),p=H(()=>f.value?.map(r=>({image:r.user?.image,name:r.user?.name,email:r.user?.email,role:r.role,ownership:r.ownership}))??[]),c=ne,v=[{accessorKey:"image",header:"",cell:({row:r})=>{const i=r.getValue("name"),N=r.getValue("image");return te(c,{size:"lg",alt:i,src:N})}},{accessorKey:"name",header:"Name"},{accessorKey:"email",header:"Email"},{accessorKey:"role",header:"Role",cell:({row:r})=>T(r.getValue("role"),"sentence")},{accessorKey:"ownership",header:"Ownership",cell:({row:r})=>`${r.getValue("ownership")}%`}],h=$(null),l=$(!1),y=async r=>{h.value=f.value?.find(i=>i.user.email===r.getValue("email"))??null,h.value&&(l.value=!0)},_=$(null),A=async(r,i)=>{_.value=null;try{await $fetch(`/api/user/financial-accounts/${x}/account-user/${r}`,{method:"delete"}),await q(),i()}catch(N){_.value=j(N)}};return(r,i)=>{const N=L,a=B,n=Y,k=K,D=O;return b(),R(D,{error:e(g),onRefresh:i[2]||(i[2]=d=>e(q)())},{default:o(()=>[t(N,{data:e(p),columns:v,loading:e(U),style:{"min-width":"0"},onSelect:y},null,8,["data","loading"]),t(k,{open:e(l),"onUpdate:open":[i[0]||(i[0]=d=>P(l)?l.value=d:null),i[1]||(i[1]=d=>d===!1?_.value=null:_.value=e(_))],title:"Remove User"},{body:o(({close:d})=>[e(h)?(b(),W("div",fe,[i[3]||(i[3]=m("p",null,"Do you want to remove this user from this account?",-1)),e(_)?(b(),R(a,{key:0,message:e(_).message},null,8,["message"])):V("",!0),m("div",ve,[t(n,{label:"Cancel",color:"neutral",variant:"soft",onClick:w=>d()},null,8,["onClick"]),t(n,{label:"Proceed",color:"error","loading-auto":"",onClick:w=>A(e(h).id,d)},null,8,["onClick"])])])):V("",!0)]),_:1},8,["open"])]),_:1},8,["error"])}}}),ge=Object.assign(ye,{__name:"UserFinancialAccountCurrentUsers"}),he={class:"flex items-center justify-end gap-2 md:col-span-2"},we=M({__name:"add-account-user-widget",props:{accountId:{},buttonProps:{default:()=>({icon:"i-lucide-user-round-plus",label:"Add partner",color:"neutral",variant:"outline"})}},setup(C){const u=$(!1),s=ae({recipientName:"",recipientEmail:"",role:"co-owner",ownership:0}),x=()=>{s.recipientName="",s.recipientEmail="",s.role="co-owner",s.ownership=0},{refresh:U}=F(`/api/user/financial-accounts/${C.accountId}/join-requests`,{key:"account-join-requests"},"$vaZ6MdCeNF"),f=$(!1),g=$(null),q=async p=>{const c={...p.data,role:T(p.data.role,"snake")};g.value=null,f.value=!0;try{await $fetch(`/api/user/financial-accounts/${C.accountId}/join-requests`,{method:"post",body:c}),await U(),x(),u.value=!1}catch(v){g.value=j(v)}finally{f.value=!1}};return(p,c)=>{const v=Y,h=B,l=Z,y=X,_=ie,A=me,r=de,i=ue,N=K;return b(),R(N,{open:e(u),"onUpdate:open":c[5]||(c[5]=a=>P(u)?u.value=a:null),title:"Joint Account Request",description:"Send a request to user you want to be part of this account."},{body:o(({close:a})=>[t(i,{state:e(s),schema:e(_e),class:"grid gap-4 md:grid-cols-2",onSubmit:le(q,["prevent"])},{default:o(()=>[e(g)?(b(),R(h,{key:0,message:e(g).message,class:"md:col-span-2"},null,8,["message"])):V("",!0),t(y,{name:"recipientName",label:"Name",required:"",class:"md:col-span-2"},{default:o(()=>[t(l,{modelValue:e(s).recipientName,"onUpdate:modelValue":c[0]||(c[0]=n=>e(s).recipientName=n),class:"w-full"},null,8,["modelValue"])]),_:1}),t(y,{name:"recipientEmail",label:"Email",required:"",class:"md:col-span-2"},{default:o(()=>[t(l,{modelValue:e(s).recipientEmail,"onUpdate:modelValue":c[1]||(c[1]=n=>e(s).recipientEmail=n),class:"w-full"},null,8,["modelValue"])]),_:1}),t(y,{name:"role",label:"Role",required:""},{default:o(()=>[t(_,{modelValue:e(s).role,"onUpdate:modelValue":c[2]||(c[2]=n=>e(s).role=n),items:e(pe),class:"w-full"},null,8,["modelValue","items"])]),_:1}),t(y,{name:"ownership",label:"Ownership (%)",required:""},{default:o(()=>[t(A,{modelValue:e(s).ownership,"onUpdate:modelValue":c[3]||(c[3]=n=>e(s).ownership=n),min:0,max:100,class:"w-full"},null,8,["modelValue"])]),_:1}),t(y,{name:"description",label:"Description",class:"md:col-span-2"},{default:o(()=>[t(r,{modelValue:e(s).description,"onUpdate:modelValue":c[4]||(c[4]=n=>e(s).description=n),class:"w-full resize-none"},null,8,["modelValue"])]),_:1}),m("div",he,[t(v,{type:"button",label:"Cancel",icon:"lucide-circle-x",color:"neutral",variant:"soft",onClick:n=>a()},null,8,["onClick"]),t(v,{type:"submit",label:"Submit",icon:"lucide-circle-check","loading-auto":""})])]),_:2},1032,["state","schema"])]),default:o(()=>[t(v,oe(se(p.buttonProps)),null,16)]),_:1},8,["open"])}}}),$e=Object.assign(we,{__name:"UserAddAccountUserWidget"}),be={key:0,class:"space-y-8"},xe={class:"grid gap-4 md:grid-cols-2"},Ne={class:"space-y-2"},qe={class:"grid gap-4 md:grid-cols-2"},Re={class:"flex justify-end mt-8 gap-2"},Ue=M({__name:"requested-account-users",async setup(C){let u,s;const x=J().getParams("accountId"),U=re(),f=$(!1),{pending:g,data:q,error:p,refresh:c}=([u,s]=S(()=>F(`/api/user/financial-accounts/${x}/join-requests`,{key:"account-join-requests"},"$HIwgFaUpZf")),u=await u,s(),u),v=H(()=>q.value?.map(a=>({name:a.recipientName,email:a.recipientEmail,role:a.role,ownership:a.ownership,requestedBy:a.creator?.name,requestDate:a.createdAt}))??[]),h=[{accessorKey:"name",header:"Name"},{accessorKey:"email",header:"Email"},{accessorKey:"role",header:"Role"},{accessorKey:"ownership",header:"Ownership",cell:({row:a})=>`${a.getValue("ownership")}%`},{accessorKey:"requestedBy",header:"Requested By"},{accessorKey:"requestDate",header:"Request Date",cell:({row:a})=>I(a.getValue("requestDate"),"MMM DD, YYYY hh:mm aa").value}],l=$(null),y=a=>{l.value=q.value?.find(n=>n.recipientEmail===a.getValue("email"))??null,l.value&&(f.value=!0)},_=$(null);async function A(a,n){try{await $fetch(`/api/user/join-requests/${a.id}`,{method:"delete"}),await c(),n()}catch(k){_.value=j(k)}}const r=$(null);async function i(a,n){try{await $fetch(`/api/user/join-requests/${a.id}/send-reminder`,{method:"post"}),U.add({color:"success",title:"Success",description:"Reminder sent successfully"}),await c(),n()}catch(k){r.value=j(k)}}const N=a=>{a===!1&&(_.value=null,r.value=null)};return(a,n)=>{const k=L,D=B,d=Z,w=X,z=Y,G=K,Q=O;return b(),R(Q,{error:e(p),onRefresh:n[1]||(n[1]=E=>e(c)())},{default:o(()=>[t(k,{data:e(v),columns:h,loading:e(g),style:{"min-width":"0"},onSelect:y},null,8,["data","loading"]),t(G,{open:e(f),"onUpdate:open":[n[0]||(n[0]=E=>P(f)?f.value=E:null),N],title:"Joint Account Request"},{body:o(({close:E})=>[e(l)?(b(),W("div",be,[e(_)||e(r)?(b(),R(D,{key:0,message:e(_)?.message||e(r)?.message},null,8,["message"])):V("",!0),m("div",null,[n[2]||(n[2]=m("h3",{class:"text-2xl font-medium"},"User Info",-1)),m("div",xe,[t(w,{label:"Name",class:"md:col-span-2"},{default:o(()=>[t(d,{value:e(l).recipientName,readonly:"",class:"w-full"},null,8,["value"])]),_:1}),t(w,{label:"Email",class:"md:col-span-2"},{default:o(()=>[t(d,{value:e(l).recipientEmail,readonly:"",class:"w-full"},null,8,["value"])]),_:1}),t(w,{label:"Role"},{default:o(()=>[t(d,{value:("toCase"in a?a.toCase:e(T))(e(l).role,"sentence"),readonly:"",class:"w-full"},null,8,["value"])]),_:1}),t(w,{label:"Ownership"},{default:o(()=>[t(d,{value:e(l).ownership+"%",readonly:"",class:"w-full"},null,8,["value"])]),_:1}),t(w,{label:"Requested By"},{default:o(()=>[t(d,{value:e(l).creator.name,readonly:"",class:"w-full"},null,8,["value"])]),_:1}),t(w,{label:"Request Date"},{default:o(()=>[t(d,{value:e(I)(e(l).createdAt,"MMM DD, YYYY hh:mm aa").value,readonly:"",class:"w-full"},null,8,["value"])]),_:1})])]),m("div",Ne,[n[3]||(n[3]=m("h3",{class:"text-2xl font-medium"},"Reminder",-1)),m("div",qe,[t(w,{label:"Reminders Sent"},{default:o(()=>[t(d,{value:e(l).reminderCount,readonly:"",class:"w-full"},null,8,["value"])]),_:1}),t(w,{label:"Last reminder sent at"},{default:o(()=>[t(d,{value:e(l).lastReminderAt?e(I)(e(l).lastReminderAt,"MMM DD, YYYY hh:mm aa").value:"No reminders sent yet",readonly:"",class:"w-full"},null,8,["value"])]),_:1})]),m("div",Re,[t(z,{label:"Cancel request",color:"error",variant:"soft",icon:"lucide-circle-x","loading-auto":"",onClick:ee=>A(e(l),E)},null,8,["onClick"]),t(z,{label:"Send reminder",icon:"lucide-clock","loading-auto":"",onClick:ee=>i(e(l),E)},null,8,["onClick"])])])])):V("",!0)]),_:1},8,["open"])]),_:1},8,["error"])}}}),ke=Object.assign(Ue,{__name:"UserFinancialAccountRequestedAccountUsers"}),Ve={class:"space-y-8"},Ce={class:"flex items-center gap-4 justify-between"},ct=M({__name:"account-users",async setup(C){let u,s;const x=J().getParams("accountId"),{data:U,error:f,refresh:g}=([u,s]=S(()=>F(`/api/user/financial-accounts/${x}`,{pick:["id","name","type","ownership","status"]},"$Hqs5qXUbjr")),u=await u,s(),u);return(q,p)=>{const c=ge,v=ce,h=$e,l=ke,y=O;return b(),R(y,{error:e(f),onRefresh:p[0]||(p[0]=_=>e(g)())},{default:o(()=>[m("div",Ve,[t(v,null,{header:o(()=>p[1]||(p[1]=[m("p",{class:"card-title"},"Account Owners",-1)])),default:o(()=>[m("div",null,[t(c)])]),_:1}),e(U)?.ownership==="joint"?(b(),R(v,{key:0},{header:o(()=>[m("div",Ce,[p[2]||(p[2]=m("div",null,[m("p",{class:"card-title"},"Pending Requests"),m("small",null," These users are yet to accept the joint account request ")],-1)),t(h,{"account-id":e(x)},null,8,["account-id"])])]),default:o(()=>[m("div",null,[t(l)])]),_:1})):V("",!0)])]),_:1},8,["error"])}}});export{ct as default};
