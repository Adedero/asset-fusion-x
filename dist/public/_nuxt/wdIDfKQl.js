import{_ as I}from"./ZpX6fDX3.js";import{_ as U}from"./noFtHZsG.js";import{l as F,R as P,P as v,E as w,c as f,J as S,b as r,n as e,L as E,w as _,U as R,o as p,a as u,Z as x,t as T,r as j}from"./BCrY3s8v.js";import{_ as A}from"./CtsDBDzy.js";import{_ as D}from"./CqYo-uwL.js";import{i as J}from"./D9B1UaIg.js";import{u as M}from"./DcHTeA6R.js";import{n as V}from"./wc51SthY.js";import{u as L}from"./CAqHKxSD.js";const G={key:0},O={class:"flex-col-center"},W=["src"],X={class:"flex-col-center gap-4"},Z={class:"w-40 h-40 rounded-full overflow-hidden bg-muted"},q=["src"],ne=F({__name:"image-changer",props:{size:{default:"10rem"},fontSize:{default:"3rem"}},setup(H){const d=M(),c=P(),a=v(!1),l=w(()=>d.user.value),k=w(()=>{const t=[[]];return l.value?.image?(t[0].push({label:"Remove image",onSelect:N}),t[0].push({label:"Change image",onSelect:()=>a.value=!0})):t[0].push({label:"Add image",onSelect:()=>a.value=!0}),t}),s=v(null),n=v(!1),h=v(null);async function C(){n.value=!0,h.value=null;try{const t=await $fetch("/api/user",{method:"PUT",body:JSON.stringify({image:s.value}),headers:{"Content-Type":"application/json"}});d.setUser({...d.user.value,image:t.image}),s.value=null,a.value=!1}catch(t){h.value=V(t),c.add({title:"Error",description:"Failed to update image",color:"error"})}finally{n.value=!1}}async function z(t){const o=t.target;if(!o.files||o.files.length===0)return;const i=o.files[0];if(!i)return;if(!i.type.startsWith("image/")){c.add({title:"Invalid file type",description:"Please select an image file.",color:"error"});return}if(i.size>2*1024*1024){c.add({title:"File too large",description:"Please select an image file smaller than 2MB.",color:"error"});return}const m=new FileReader;m.onload=()=>{s.value=m.result,a.value=!0},m.readAsDataURL(i)}const g=L("/api/user",{body:{image:null},method:"PUT",immediate:!1},"$fkBgTSXf_J");async function N(){if(await g.execute(),g.error.value||!g.data.value){console.log(g.error.value),c.add({title:"Error",description:"Failed to remove image",color:"error"});return}d.setUser({...d.user.value,image:null}),c.add({title:"Success",description:"Image removed successfully",color:"success"})}return(t,o)=>{const i=I,m=U,y=j,$=A,B=D;return p(),f("div",null,[e(l)?(p(),f("div",G,[E(t.$slots,"default",{user:e(l)},()=>[u("div",O,[r(i,{items:e(k),ui:{content:"w-48"}},{content:_(()=>o[2]||(o[2]=[u("div",null,"Content sd sd sdsdsdsdsdsds",-1)])),default:_(()=>[u("div",{class:"cursor-pointer rounded-full bg-accented text-muted overflow-hidden *:transition-transform hover:*:scale-120",style:x({width:t.size,height:t.size})},[e(l).image?(p(),f("img",{key:1,src:e(l).image,class:"w-full h-full object-cover rounded-full"},null,8,W)):(p(),f("div",{key:0,class:"w-full h-full flex-center text-2xl p-4 font-semibold uppercase",style:x({fontSize:t.fontSize})},T(("initials"in t?t.initials:e(J))(e(l).name??"")),5))],4)]),_:1},8,["items"])])])])):S("",!0),r(B,{open:e(a),"onUpdate:open":o[1]||(o[1]=b=>R(a)?a.value=b:null),title:"Profile image editor"},{body:_(()=>[u("div",X,[u("div",Z,[e(s)||e(l)?.image?(p(),f("img",{key:0,src:e(s)||e(l)?.image||void 0,class:"w-full h-full object-cover"},null,8,q)):S("",!0)]),u("div",null,[r($,{class:"w-full"},{default:_(()=>[r(m,{type:"file",accept:"image/*",class:"w-full",loading:e(n),disabled:e(n),onChange:z},null,8,["loading","disabled"]),r(y,{disabled:!e(s),icon:"i-lucide-x",color:"neutral",variant:"outline",onClick:o[0]||(o[0]=b=>s.value=null)},null,8,["disabled"]),r(y,{icon:"i-lucide-check",disabled:!e(s)||e(n),loading:e(n),onClick:C},null,8,["disabled","loading"])]),_:1})])])]),_:1},8,["open"])])}}});export{ne as _};
