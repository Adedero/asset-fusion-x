import{_ as K}from"./C_w5PVnp.js";import{l as D,f as Q,c as _,J as v,n as e,o as n,b as t,y as F,r as U,I as Y,t as z,R as G,P as N,L as X,K as Z,T as ee,S as te,E as R,w as s,a as c,H as k,d as ae,W as le,U as P,M as oe}from"./CVwvMgBG.js";import{_ as q}from"./BaciPMwD.js";import{t as V}from"./ChRclvJ-.js";import{u as T}from"./BWylYwCy.js";import{_ as ne}from"./BjJADY5a.js";import{_ as j}from"./mGNbPSyX.js";import{_ as se}from"./B9XHDwWB.js";import{a as re,_ as ce}from"./D7s51L10.js";import{_ as ie}from"./BZPumJrv.js";import{_ as ue}from"./C-BGqY-V.js";import{n as M}from"./CftSbWNE.js";import{_ as de}from"./B4p64Xk_.js";import{z as $}from"./B_lSGf9J.js";import{u as me}from"./CA--58-j.js";import{_ as pe}from"./C5cbwpr9.js";import{_ as _e}from"./BQH4YRWo.js";import"./C2OazYEN.js";import"./D_ajDymQ.js";import"./fF25g3x0.js";import"./BeAYYLxY.js";import"./CSRlhb3z.js";import"./BRbhiJmG.js";import"./C46oJ1TD.js";import"./Ctcj3xgC.js";import"./C40-9aZM.js";import"./BvhMhgb1.js";import"./jFYhBC76.js";import"./CHIgUVhi.js";import"./Bgc-ZZWy.js";import"./TnZ4cY_b.js";import"./CM2wjgdt.js";const fe={key:0},we={key:1,class:"flex-col-center gap-2"},ye=D({__name:"account-balance",props:{accountId:{},class:{default:""}},emits:["update"],setup(u,{emit:p}){const f=p,{pending:y,data:a,error:d,refresh:w}=T(`/api/user/financial-accounts/${u.accountId}`,{pick:["balance"]},"$_MLRSPwAOe"),A=async()=>{await w(),f("update",a.value?.balance??0)};return Q(async()=>{await A()}),(l,g)=>{const x=F,I=q,r=U;return e(y)?(n(),_("div",fe,[t(x,{name:"lucide-loader",class:"animate animate-spin"})])):e(d)?(n(),_("div",we,[t(I,{message:"Failed to get account balance"}),t(r,{label:"Retry",size:"sm",color:"error",variant:"soft",onClick:A})])):e(a)?(n(),_("p",{key:2,class:Y(u.class)},z(("toDollar"in l?l.toDollar:e(V))(e(a).balance)),3)):v("",!0)}}}),be=Object.assign(ye,{__name:"UserAccountBalance"}),ve=D({__name:"withdrawal-creator",props:{transaction:{},buttonProps:{default:()=>({size:"lg",label:"Submit"})}},setup(u){const p=G(),f=N(!1),y=N(null),a=async()=>{y.value=null,f.value=!0;try{const d=await $fetch("/api/user/transactions/withdrawal",{method:"POST",body:u.transaction});p.add({color:"success",title:"Success",description:d.message}),setTimeout(()=>{ee(`/user/accounts/${u.transaction.financialAccountId}/transactions`)},2e3)}catch(d){y.value=M(d),p.add({color:"error",title:y.value.name??"Eror",description:y.value.message})}finally{f.value=!1}};return(d,w)=>{const A=U;return n(),_("div",{class:"cursor-pointer",onClick:a},[X(d.$slots,"default",{},()=>[t(A,Z(d.buttonProps,{loading:e(f)}),null,16,["loading"])])])}}}),ge=Object.assign(ve,{__name:"UserWithdrawalCreator"}),he={class:"space-y-4"},ke={key:0},Ae={class:"flex-col-center gap-2 fluid"},xe={class:"grid md:grid-cols-2 gap-4"},$e={key:0},Ne={class:"space-y-4"},Ie={class:"flex-col-center gap-1"},We={class:"text-center text-3xl font-semibold font-geist-mono"},Ve={class:"text-muted text-sm text-center mt-2"},ze={class:"grid md:grid-cols-2 gap-4"},De={key:0,class:"contents"},Ue={key:1,class:"contents"},Ce={class:"w-full flex gap-2 justify-end"},Se=D({__name:"withdrawal-form",props:{currency:{}},setup(u){const p=me().getParams("accountId"),f=N(0),y=$.object({amount:$.number({message:"Amount is required"}),walletAddress:$.string({message:"Invalid wallet address"}).optional(),walletAddressNetwork:$.string({message:"Invalid wallet address network"}).optional(),accountNumber:$.string({message:"Invalid account number"}).optional(),bank:$.string({message:"Invalid bank"}).optional(),description:$.string({message:"Invalid description"}).optional()}),a=te({amount:0}),d=R(()=>f.value>0&&f.value-a.amount>=(u.currency.withdrawalCharge??0)),w=R(()=>u.currency.symbol==="WIRE"?!a.amount||!a.bank||!a.accountNumber:!a.amount||!a.walletAddress),A=()=>{a.amount=0,a.bank=void 0,a.accountNumber=void 0,a.walletAddress=void 0,a.walletAddressNetwork=void 0,a.description=void 0},l=N(null),g=N(!1),x=N(null),I=async r=>{const{amount:o}=r.data;if(!(!o||!d.value||w.value)){if(u.currency.symbol==="WIRE"){l.value={financialAccountId:p,amount:o/(u.currency.rate??1),currency:"USD",USDAmount:o,rate:u.currency.rate,type:"withdrawal",charges:u.currency.withdrawalCharge??0,bank:a.bank,accountNumber:a.accountNumber,description:a.description},g.value=!0;return}try{const h=await $fetch("/api/user/transactions/init-withdrawal",{query:{symbol:u.currency.symbol,amount:o}});l.value={financialAccountId:p,amount:h.currencyDepositAmount,currency:h.currency.symbol,USDAmount:o,rate:h.currency.rate,type:"withdrawal",charges:u.currency.withdrawalCharge,withdrawalWalletAddress:a.walletAddress,withdrawalWalletAddressNetwork:a.walletAddressNetwork,description:a.description},g.value=!0,A()}catch(h){x.value=M(h)}}};return(r,o)=>{const h=q,W=be,C=ne,S=j,O=se,m=re,b=ie,B=ue,E=U,L=ce,H=ge,J=de;return n(),_("div",null,[t(L,{state:e(a),schema:e(y),onSubmit:le(I,["prevent"])},{default:s(()=>[c("div",he,[e(x)?(n(),_("div",ke,[t(h,{message:e(x).message},null,8,["message"])])):v("",!0),c("div",Ae,[t(W,{ref:"account-balance-component","account-id":e(p),class:"text-3xl font-medium font-geist-mono",onUpdate:o[0]||(o[0]=i=>f.value=i)},null,8,["account-id"]),t(C,{label:"Account Balance",variant:"outline"})]),e(d)?v("",!0):(n(),k(S,{key:1,color:"error",variant:"soft",description:"You do not have sufficient balance to complete this transaction."})),c("div",xe,[t(m,{name:"amount",label:"Enter the deposit amount",required:"",description:`Charges: ${("toDollar"in r?r.toDollar:e(V))(r.currency.withdrawalCharge??0)}`,class:"md:col-span-2"},{default:s(()=>[t(O,{modelValue:e(a).amount,"onUpdate:modelValue":o[1]||(o[1]=i=>e(a).amount=i),"format-options":{style:"currency",currency:"USD",currencyDisplay:"symbol",currencySign:"standard",minimumFractionDigits:2,maximumFractionDigits:2},size:"lg",class:"w-full"},null,8,["modelValue"])]),_:1},8,["description"]),r.currency.symbol!=="WIRE"?(n(),k(m,{key:0,name:"walletAddress",label:"Wallet address",required:""},{default:s(()=>[t(b,{modelValue:e(a).walletAddress,"onUpdate:modelValue":o[2]||(o[2]=i=>e(a).walletAddress=i),size:"lg",class:"w-full"},null,8,["modelValue"])]),_:1})):v("",!0),r.currency.symbol!=="WIRE"?(n(),k(m,{key:1,name:"walletAddressNetwork",label:"Wallet address network"},{default:s(()=>[t(b,{modelValue:e(a).walletAddressNetwork,"onUpdate:modelValue":o[3]||(o[3]=i=>e(a).walletAddressNetwork=i),size:"lg",class:"w-full"},null,8,["modelValue"])]),_:1})):v("",!0),r.currency.symbol==="WIRE"?(n(),k(m,{key:2,name:"bank",label:"Bank name",required:""},{default:s(()=>[t(b,{modelValue:e(a).bank,"onUpdate:modelValue":o[4]||(o[4]=i=>e(a).bank=i),size:"lg",class:"w-full"},null,8,["modelValue"])]),_:1})):v("",!0),r.currency.symbol==="WIRE"?(n(),k(m,{key:3,name:"accountNumber",label:"Account number",required:""},{default:s(()=>[t(b,{modelValue:e(a).accountNumber,"onUpdate:modelValue":o[5]||(o[5]=i=>e(a).accountNumber=i),size:"lg",class:"w-full"},null,8,["modelValue"])]),_:1})):v("",!0),t(m,{name:"description",label:"Description",description:"Add an optional description to your withdrawal request",class:"md:col-span-2"},{default:s(()=>[t(B,{modelValue:e(a).description,"onUpdate:modelValue":o[6]||(o[6]=i=>e(a).description=i),size:"lg",class:"w-full",rows:3},null,8,["modelValue"])]),_:1})]),t(E,{type:"submit",class:"mt-2",size:"lg",icon:"i-lucide-check-circle","loading-auto":"",disabled:!e(d)||e(w)},{default:s(()=>o[9]||(o[9]=[ae(" Submit ")])),_:1,__:[9]},8,["disabled"])])]),_:1},8,["state","schema"]),t(J,{open:e(g),"onUpdate:open":o[8]||(o[8]=i=>P(g)?g.value=i:null),dismissible:!1,title:"Withdrawal Request",description:"Review the details of your withdrawal request."},{body:s(()=>[e(l)?(n(),_("div",$e,[c("div",Ne,[c("header",Ie,[o[10]||(o[10]=c("p",{class:"card-title"},"Amount",-1)),c("h3",We,z(("toDollar"in r?r.toDollar:e(V))(e(l).USDAmount)),1),t(C,{label:r.currency.name,variant:"soft"},null,8,["label"]),c("p",Ve," Charges: "+z(("toDollar"in r?r.toDollar:e(V))(e(l).charges)),1)]),c("div",ze,[t(m,{label:"Currency"},{default:s(()=>[t(b,{value:e(l).currency,readonly:"",size:"lg",class:"w-full"},null,8,["value"])]),_:1}),t(m,{label:`Rate: 1 ${e(l).currency} to USD`},{default:s(()=>[t(b,{value:e(l).rate,readonly:"",size:"lg",class:"w-full"},null,8,["value"])]),_:1},8,["label"]),t(m,{class:"md:col-span-2",label:`Withdrawal amount in ${e(l).currency}`},{default:s(()=>[t(b,{value:e(l).amount,readonly:"",size:"lg",class:"w-full"},null,8,["value"])]),_:1},8,["label"]),t(S,{class:"md:col-span-2",variant:"soft",description:`${e(l).amount} ${e(l).currency} will be sent to your provided account details within 24 hours.`},null,8,["description"]),r.currency.symbol==="WIRE"?(n(),_("div",De,[t(m,{label:"Bank"},{default:s(()=>[t(b,{value:e(l).bank,size:"lg",class:"w-full",readonly:""},null,8,["value"])]),_:1}),t(m,{label:"Account number"},{default:s(()=>[t(b,{value:e(l).accountNumber,size:"lg",class:"w-full",readonly:""},null,8,["value"])]),_:1})])):(n(),_("div",Ue,[t(m,{label:"Wallet address"},{default:s(()=>[t(b,{value:e(l).withdrawalWalletAddress,size:"lg",class:"w-full",readonly:""},null,8,["value"])]),_:1}),t(m,{label:"Wallet address network"},{default:s(()=>[t(b,{value:e(l).withdrawalWalletAddressNetwork,size:"lg",class:"w-full",readonly:""},null,8,["value"])]),_:1})])),e(l).description?(n(),k(m,{key:2,label:"Description",class:"md:col-span-2"},{default:s(()=>[t(B,{value:e(l).description,size:"lg",class:"w-full resize-none",readonly:""},null,8,["value"])]),_:1})):v("",!0)]),c("div",Ce,[t(E,{label:"Cancel",color:"neutral",variant:"soft",size:"lg",icon:"lucide-circle-x",onClick:o[7]||(o[7]=i=>g.value=!1)}),t(H,{transaction:e(l),"button-props":{size:"lg",label:"Proceed",trailingIcon:"i-lucide-circle-arrow-right"}},null,8,["transaction"])])])])):v("",!0)]),_:1},8,["open"])])}}}),Be=Object.assign(Se,{__name:"UserWithdrawalForm"}),Ee={key:0},Re={key:0,class:"w-full h-full md:flex space-x-4 space-y-4 md:space-y-0"},Fe={class:"h-full max-h-96 md:max-h-[34rem] md:flex-shrink-0 overflow-y-auto w-full md:w-72 border rounded-md border-muted p-4"},Pe={class:"h-full overflow-y-auto md:flex-grow p-0.5"},qe={key:0,class:"h-60 fluid flex-col-center gap-4"},Te={class:"text-xl font-semibold"},je={key:1},ht=D({__name:"withdraw",async setup(u){let p,f;const{data:y,error:a,refresh:d}=([p,f]=oe(()=>T("/api/settings",{key:"settings"},"$e0BQhje86s")),p=await p,f(),p),w=N(null);return(A,l)=>{const g=K,x=F,I=Be,r=pe,o=j,h=_e;return n(),k(h,{error:e(a),onRefresh:l[1]||(l[1]=W=>e(d)())},{default:s(()=>[e(y)?(n(),_("div",Ee,[e(y).allowWithdrawals?(n(),_("div",Re,[c("div",Fe,[l[2]||(l[2]=c("header",{class:"mb-4"},[c("p",{class:"card-title"},"Select medium")],-1)),t(g,{modelValue:e(w),"onUpdate:modelValue":l[0]||(l[0]=W=>P(w)?w.value=W:null),"only-withdrawal-currencies":!0},null,8,["modelValue"])]),c("div",Pe,[e(w)?(n(),k(r,{key:1},{header:s(()=>[c("p",Te,z(e(w).symbol)+" Withdrawal ",1)]),default:s(()=>[c("div",null,[t(I,{currency:e(w)},null,8,["currency"])])]),_:1})):(n(),_("div",qe,[t(x,{name:"lucide-coins",size:"6rem",class:"text-muted"}),l[3]||(l[3]=c("p",{class:"card-title"},"Select a withdrawal medium",-1))]))])])):(n(),_("div",je,[t(o,{color:"error",variant:"subtle",icon:"lucide-alert-circle",title:"Withdrawal Alert",description:"Withdrawal are not allowed at this time. Please, check back later."})]))])):v("",!0)]),_:1},8,["error"])}}});export{ht as default};
