import{_ as C}from"./CidxsHgk.js";import{_ as k}from"./noFtHZsG.js";import{_ as h,a as F}from"./Bkd0wxOE.js";import{_ as $}from"./CJ_RDHPa.js";import{_ as z}from"./DbqLP4vC.js";import{l as B,du as U,S as q,P as I,c as f,J as L,b as a,n as s,w as r,W as P,o as p,a as R,_ as T,d as g,r as A,aI as w,q as j,T as c}from"./BCrY3s8v.js";import{a as b}from"./BtBUy-pL.js";import{L as D}from"./RZnrL4AU.js";import{n as J}from"./wc51SthY.js";import{u as W}from"./DcHTeA6R.js";const G={key:0,class:"mb-3"},H={class:"flex items-center gap-2 justify-between"},ne=B({__name:"sign-in-form",setup(K){const d=j(),x=U(),_=W(),t=q({email:"",password:"",rememberMe:!0});function V(){t.email="",t.password="",t.rememberMe=!0}const l=I(null);async function N(u){l.value=null;const e=btoa(u.data.email);await b.signIn.email(u.data,{onError(o){l.value=J(o.error)},async onSuccess(){V();const o=await b.getSession();if(!o.data)throw w({status:500,statusMessage:d.public.defaultErrorMsg,fatal:!0});_.setSession(o.data.session),_.setUser(o.data.user);const{redirect:i}=x.query;if(i){await c(i.toString());return}if(!o.data?.user.emailVerified){await c({name:"email-verification",query:{email:e}});return}const n=o.data?.user.role;if(!n)throw w({status:500,statusMessage:d.public.defaultErrorMsg,fatal:!0});if(n==="admin"){console.log(n);return}if(n==="user"){await c("/user");return}}})}return(u,e)=>{const o=C,i=k,n=F,S=$,M=z,E=T,v=A,y=h;return p(),f("div",null,[s(l)?(p(),f("div",G,[a(o,{message:s(l).message},null,8,["message"])])):L("",!0),a(y,{schema:s(D),state:s(t),class:"space-y-4",onSubmit:P(N,["prevent"])},{default:r(()=>[a(n,{label:"Email",name:"email"},{default:r(()=>[a(i,{modelValue:s(t).email,"onUpdate:modelValue":e[0]||(e[0]=m=>s(t).email=m),size:"lg",class:"w-full"},null,8,["modelValue"])]),_:1}),a(n,{label:"Password",name:"password"},{default:r(()=>[a(S,{modelValue:s(t).password,"onUpdate:modelValue":e[1]||(e[1]=m=>s(t).password=m),size:"lg",class:"w-full"},null,8,["modelValue"])]),_:1}),R("div",H,[a(n,{name:"rememberMe"},{default:r(()=>[a(M,{modelValue:s(t).rememberMe,"onUpdate:modelValue":e[2]||(e[2]=m=>s(t).rememberMe=m),label:"Remember me"},null,8,["modelValue"])]),_:1}),a(E,{to:"/forgot-password",class:"link text-sm"},{default:r(()=>e[3]||(e[3]=[g("Forgot password")])),_:1,__:[3]})]),a(v,{type:"submit",class:"mt-2 w-full flex-center",size:"lg",icon:"i-lucide-log-in","loading-auto":""},{default:r(()=>e[4]||(e[4]=[g(" Submit ")])),_:1,__:[4]})]),_:1},8,["schema","state"])])}}});export{ne as _};
