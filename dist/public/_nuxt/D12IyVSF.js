import{_ as L}from"./CwNR5WVR.js";import{_ as j}from"./CidxsHgk.js";import{_ as N}from"./noFtHZsG.js";import{a as O,_ as G}from"./Bkd0wxOE.js";import{_ as W}from"./C8seO8KE.js";import{_ as J}from"./A1aqh1bs.js";import{l as E,af as Z,ag as q,P as V,H as F,o as x,w as A,b as d,I as H,n as t,R as K,M as X,S as C,c as $,J as w,a as b,W as Q,r as ee}from"./BCrY3s8v.js";import{_ as te}from"./GUhg-1-n.js";import{r as oe,u as ae}from"./Dsaz7ZGA.js";import{_ as ie}from"./RTrhuSk4.js";import{B as se,m as le}from"./RZnrL4AU.js";import{n as ne}from"./wc51SthY.js";import{u as re}from"./mHVIAYtm.js";import{u as ce}from"./CAqHKxSD.js";import"./Df43cr2Y.js";import"./IDdVFqQ_.js";import"./1c9ch5oL.js";import"./DGxpg-Ox.js";import"./CpLtEdiG.js";import"./YE4bf-b6.js";import"./8tY1C0Fy.js";import"./DSCz-RR9.js";import"./kRIii9yh.js";import"./CZ2Yaa7T.js";import"./BsY6ekDi.js";import"./jFYhBC76.js";import"./CHIgUVhi.js";import"./C3npS8vC.js";const S={};function ue(e,r,s){let o;{const a=Date.now(),l=oe();de(S,a,l),o=me(l,S.msecs,S.seq,r,s)}return r??ae(o)}function de(e,r,s){return e.msecs??=-1/0,e.seq??=0,r>e.msecs?(e.seq=s[6]<<23|s[7]<<16|s[8]<<8|s[9],e.msecs=r):(e.seq=e.seq+1|0,e.seq===0&&e.msecs++),e}function me(e,r,s,o,a=0){if(e.length<16)throw new Error("Random bytes length must be >= 16");if(!o)o=new Uint8Array(16),a=0;else if(a<0||a+16>o.length)throw new RangeError(`UUID byte range ${a}:${a+15} is out of buffer bounds`);return r??=Date.now(),s??=e[6]*127<<24|e[7]<<16|e[8]<<8|e[9],o[a++]=r/1099511627776&255,o[a++]=r/4294967296&255,o[a++]=r/16777216&255,o[a++]=r/65536&255,o[a++]=r/256&255,o[a++]=r&255,o[a++]=112|s>>>28&15,o[a++]=s>>>20&255,o[a++]=128|s>>>14&63,o[a++]=s>>>6&255,o[a++]=s<<2&255|e[10]&3,o[a++]=e[11],o[a++]=e[12],o[a++]=e[13],o[a++]=e[14],o[a++]=e[15],o}async function fe(e){return new Promise(r=>{const s=new FileReader;s.onload=()=>r(s.result),s.readAsDataURL(e)})}const pe=E({__name:"simple-file-input",props:Z({label:{default:()=>{}},description:{default:()=>{}},accept:{default:()=>{}},size:{default:"lg"},maxFileSize:{default:()=>{}},multiple:{type:[Boolean,Number],default:!1},inputClass:{default:()=>{}},forceConstraints:{type:Boolean,default:!1}},{modelValue:{default:[]},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const r=q(e,"modelValue"),s=V(void 0),o=async i=>{const u=i.target,n=Array.from(u.files??[]),g=a(e.accept),p=typeof e.multiple=="number"?e.multiple:1/0,m=[],y=[];for await(const h of n){const _=[];if(l(h,g)||_.push(`"${h.name}" is not an accepted file type.`),e.maxFileSize&&h.size>e.maxFileSize&&_.push(`"${h.name}" exceeds max size of ${B(e.maxFileSize)}.`),_.length>0)if(e.forceConstraints){s.value=_[0];break}else{y.push(..._);continue}if(m.length>=p)if(e.forceConstraints){s.value=`Upload limit of ${p} exceeded.`;break}else break;const c=h.name.match(/\.([a-zA-Z0-9]+)$/),v=c?c[1]?.toLowerCase()??"unknown":"";m.push({id:ue(),url:await fe(h),blob:h,ext:v})}!e.forceConstraints&&y.length>0&&(s.value=y[0]),e.multiple?r.value=[...r.value,...m].slice(0,p):r.value=m.slice(0,1)};function a(i){return i?Array.isArray(i)?i:i.split(",").map(u=>u.trim()):[]}function l(i,u){return u.length===0?!0:u.some(n=>{if(n.startsWith("."))return i.name.toLowerCase().endsWith(n.toLowerCase());if(n.includes("/*")){const[g]=n.split("/"),[p]=i.type.split("/");return g===p}return i.type===n})}function B(i,u=2){if(i===0)return"0 B";const n=1024,g=u<0?0:u,p=["B","KB","MB","GB","TB"],m=Math.floor(Math.log(i)/Math.log(n));return`${parseFloat((i/Math.pow(n,m)).toFixed(g))} ${p[m]}`}return(i,u)=>{const n=N,g=O;return x(),F(g,{label:i.label,description:i.description,error:t(s)},{default:A(()=>[d(n,{type:"file",size:i.size,accept:Array.isArray(i.accept)?i.accept.join(","):i.accept,multiple:!!i.multiple,class:H(i.inputClass),onChange:o},null,8,["size","accept","multiple","class"])]),_:1},8,["label","description","error"])}}}),_e=Object.assign(pe,{__name:"NuxtSimpleFileInput"}),xe={key:0,class:"flex justify-center fluid pb-4"},ge={class:"md:w-96"},he={class:"grid gap-4"},ye={key:0,class:"flex flex-wrap gap-2 justify-end"},ve=["href","download"],we=["href","download"],be={key:1},Ke=E({__name:"business-profile",async setup(e){let r,s;const o=re().getParams("accountId"),a=K(),{data:l,error:B,refresh:i}=([r,s]=X(()=>ce(`/api/user/financial-accounts/${o}/business-profile`,{key:"financial-account-business-profile"},"$4uXZiAGaiR")),r=await r,s(),r),u=C({address:l.value?.profile?.address??"",creationMonth:l.value?.profile?.creationMonth??"January",creationYear:l.value?.profile?.creationYear??new Date().getFullYear()}),n=C({proofOfAddress:[],certificate:[]}),g=async _=>{await y(_.data)},p=V(!1),m=V(null);async function y(_){const c={..._,proofOfAddress:l.value?.profile?.proofOfAddress||n.proofOfAddress[0]?.url,proofOfAddressExt:l.value?.profile?.proofOfAddressExt||n.proofOfAddress[0]?.ext,certificate:l.value?.profile?.certificate||n.certificate[0]?.url,certificateExt:l.value?.profile?.certificateExt||n.certificate[0]?.ext};m.value=null,p.value=!0;try{await $fetch(`/api/user/financial-accounts/${o}/business-profile`,{method:"PUT",body:c}),i(),n.proofOfAddress=[],n.certificate=[],a.add({color:"success",title:"Success",description:"Business profile updated successfully."})}catch(v){m.value=ne(v)}finally{p.value=!1}}async function h(){await y()}return(_,c)=>{const v=L,I=j,D=N,M=O,U=W,R=J,z=ee,P=G,Y=te,k=_e,T=ie;return x(),F(T,{error:t(B),onRetry:c[5]||(c[5]=f=>t(i)())},{default:A(()=>[t(l)?(x(),$("div",xe,[b("div",ge,[t(l).profile&&!t(l).profile.approved?(x(),F(v,{key:0,class:"mb-4",variant:"subtle",title:"Approval status",description:"Your business profile is awaiting approval."})):w("",!0),t(l).profile&&t(l).profile.approved?(x(),F(v,{key:1,class:"mb-4",variant:"subtle",title:"Approval status",description:"Your business profile has been approved."})):w("",!0),t(m)?(x(),F(I,{key:2,title:t(m).name,message:t(m).message,class:"mb-4"},null,8,["title","message"])):w("",!0),d(P,{state:t(u),schema:t(se),class:"grid gap-4 md:grid-cols-2",onSubmit:Q(g,["prevent"])},{default:A(()=>[c[6]||(c[6]=b("h3",{class:"text-2xl font-medium"},"Business Info",-1)),d(M,{name:"address",label:"Business address",class:"w-full md:col-span-2"},{default:A(()=>[d(D,{modelValue:t(u).address,"onUpdate:modelValue":c[0]||(c[0]=f=>t(u).address=f),size:"lg",class:"w-full"},null,8,["modelValue"])]),_:1}),d(M,{name:"creationMonth",label:"Month of creation",class:"w-full"},{default:A(()=>[d(U,{modelValue:t(u).creationMonth,"onUpdate:modelValue":c[1]||(c[1]=f=>t(u).creationMonth=f),items:t(le).map(f=>f.long),size:"lg",class:"w-full"},null,8,["modelValue","items"])]),_:1}),d(M,{name:"creationYear",label:"Year of creation",class:"w-full"},{default:A(()=>[d(R,{modelValue:t(u).creationYear,"onUpdate:modelValue":c[2]||(c[2]=f=>t(u).creationYear=f),min:1e3,max:new Date().getFullYear(),"format-options":{useGrouping:!1},size:"lg",class:"w-full"},null,8,["modelValue","max"])]),_:1}),b("div",null,[d(z,{type:"submit",size:"lg",icon:"lucide-circle-check",label:"Submit","loading-auto":""})])]),_:1,__:[6]},8,["state","schema"]),d(Y,{class:"my-8"}),b("div",he,[c[7]||(c[7]=b("h3",{class:"text-2xl font-medium"},"Documents",-1)),t(l).profile?.proofOfAddress||t(l).profile?.certificate?(x(),$("div",ye,[t(l).profile?.proofOfAddress?(x(),$("a",{key:0,href:t(l).profile.proofOfAddress,download:`${t(o)}-PROOF_OF_ADDRESS.${t(l).profile?.proofOfAddressExt}`},[d(z,{label:"Proof of address",icon:"lucide-download",size:"sm",color:"neutral",variant:"outline"})],8,ve)):w("",!0),t(l).profile?.certificate?(x(),$("a",{key:1,href:t(l).profile.certificate,download:`${t(o)}-BUSINESS_CERTIFICATE.${t(l).profile?.certificateExt}`},[d(z,{label:"Certificate",icon:"lucide-download",size:"sm",color:"neutral",variant:"outline"})],8,we)):w("",!0)])):(x(),$("div",be,[d(v,{class:"mb-4",color:"warning",variant:"subtle",description:"No documents submitted yet. Upload your documents to complete your business profile."})])),d(k,{modelValue:t(n).proofOfAddress,"onUpdate:modelValue":c[3]||(c[3]=f=>t(n).proofOfAddress=f),label:"Proof of address",description:"Image or PDF files not more than 2MB",class:"w-full","input-class":"w-full",accept:["image/*","application/pdf"],"max-file-size":2*1024*1024,"force-constraints":!0},null,8,["modelValue"]),d(k,{modelValue:t(n).certificate,"onUpdate:modelValue":c[4]||(c[4]=f=>t(n).certificate=f),label:"Business certificate",description:"Image or PDF files not more than 2MB",class:"w-full","input-class":"w-full",accept:["image/*","application/pdf"],"max-file-size":2*1024*1024,"force-constraints":!0},null,8,["modelValue"]),b("div",null,[d(z,{type:"submit",size:"lg",icon:"lucide-circle-check",label:"Submit",loading:t(p),disabled:!t(n).proofOfAddress.length&&!t(n).certificate.length,onClick:h},null,8,["loading","disabled"])])])])])):w("",!0)]),_:1},8,["error"])}}});export{Ke as default};
