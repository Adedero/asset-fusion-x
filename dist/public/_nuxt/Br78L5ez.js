import{_ as $}from"./CwNR5WVR.js";import{_ as N}from"./BA4GzNlT.js";import{_ as U}from"./CidxsHgk.js";import{_ as Y}from"./Bz1yoids.js";import{_ as j}from"./noFtHZsG.js";import{l as B,R as F,M as K,S as M,P as S,H as y,w as r,n as e,o as c,c as m,J as g,b as t,T as z,a as u,r as R}from"./BCrY3s8v.js";import{_ as A}from"./RTrhuSk4.js";import{n as L}from"./wc51SthY.js";import{u as W}from"./CAqHKxSD.js";import"./DGxpg-Ox.js";import"./1c9ch5oL.js";import"./CpLtEdiG.js";import"./8tY1C0Fy.js";import"./CHIgUVhi.js";import"./Bar4WUZu.js";import"./jFYhBC76.js";import"./CZ2Yaa7T.js";import"./D8mweQSH.js";const q={key:0},H={key:0,class:"fluid flex-center"},J={key:1,class:"fluid flex-center"},O={class:"space-y-4"},G={class:"space-y-4"},Q={key:2,class:"fluid flex-center"},X={key:3,class:"fluid flex-center"},Z={key:4,class:"fluid flex-center"},ee={class:"space-y-4"},te={class:"space-y-4"},oe={key:5,class:"fluid flex-center"},Ce=B({__name:"kyc",async setup(ie){let p,v;const k=F(),{data:n,error:P,refresh:h}=([p,v]=K(()=>W("/api/user/profile",{key:"user-profile"},"$WwVoRVSESA")),p=await p,v(),p),x=["International passport","National ID","Driving license"],l=M({governmentId:"",governmentIdType:"",governmentIdExt:""}),d=S(null),f=S(!1);async function C(){const i=Object.keys(l).find(o=>!l[o]?.length);if(i){d.value=new Error(`Missing required field: ${i}`);return}const a=l.governmentIdType.toLowerCase().replace(/\s+/g,"_");f.value=!0,d.value=null;try{await $fetch("/api/user/profile/kyc",{method:"PUT",body:{...l,governmentIdType:a},headers:{"Content-Type":"application/json"}}),await h()}catch(o){d.value=L(o)}finally{f.value=!1}}function b(i){const o=i.target.files?.[0];if(!o)return;if(!o.type.startsWith("image/")&&o.type!=="application/pdf"){k.add({title:"Invalid file type",description:"Please select an image or a PDF file.",color:"error"});return}if(o.size>2*1024*1024){k.add({title:"File too large",description:"Please select an image file smaller than 2MB.",color:"error"});return}l.governmentIdExt=o.name.split(".").pop()?.toLowerCase()||"";const s=new FileReader;s.onload=()=>{l.governmentId=s.result},s.readAsDataURL(o)}function w(){if(!n.value?.profile?.governmentId)return;const i=document.createElement("a");i.style.display="none",i.style.position="absolute",i.href=n.value.profile.governmentId,i.download=`USER_ID.${n.value.profile.governmentIdExt}`,document.body.appendChild(i),i.click(),document.body.removeChild(i)}return(i,a)=>{const o=$,s=N,I=U,T=Y,D=j,V=R,E=A;return c(),y(E,{error:e(P),onRetry:a[2]||(a[2]=_=>e(h)())},{default:r(()=>[e(n)?(c(),m("div",q,[e(n).profile?e(n).profile.kycStatus?e(n).profile.kycStatus==="pending"?(c(),m("div",Q,[t(s,{class:"max-w-[30rem]"},{default:r(()=>[t(o,{title:"KYC Verification",description:"Your data is still being validated. Check again later.",icon:"i-lucide-alert-circle",variant:"subtle",ui:{actions:"justify-end"},actions:[{label:"Donwload",size:"md",onClick:()=>{w()}}]},null,8,["actions"])]),_:1})])):e(n).profile.kycStatus==="rejected"?(c(),m("div",X,[t(s,{class:"max-w-[30rem]"},{default:r(()=>[t(o,{title:"KYC Verification",description:"Your KYC data has been rejected. Please contact us for more information.",icon:"i-lucide-alert-triangle",color:"error",variant:"subtle",ui:{actions:"justify-end"},actions:[{label:"Contact us",size:"md",color:"error",onClick:()=>{("navigateTo"in i?i.navigateTo:e(z))("/user/contact")}}]},null,8,["actions"])]),_:1})])):e(n).profile.kycStatus==="resubmit"?(c(),m("div",Z,[t(s,{class:"max-w-[30rem]"},{header:r(()=>a[4]||(a[4]=[u("p",{class:"card-title"},"Upload a valid government-issued ID",-1)])),footer:r(()=>[t(o,{title:"KYC Verification",description:"We could not complete your verification. Please resubmit your data.",icon:"i-lucide-alert-circle",variant:"subtle",color:"error"})]),default:r(()=>[u("div",ee,[e(d)?(c(),y(I,{key:0,title:e(d).name,message:e(d).message},null,8,["title","message"])):g("",!0),u("div",te,[t(T,{modelValue:e(l).governmentIdType,"onUpdate:modelValue":a[1]||(a[1]=_=>e(l).governmentIdType=_),items:x,size:"lg",placeholder:"Select ID type",class:"w-full"},null,8,["modelValue"]),t(D,{type:"file",size:"lg",class:"w-full",accept:"image/*,.pdf",onChange:b}),t(V,{size:"lg",label:"Submit",icon:"i-lucide-check-circle",loading:e(f),onClick:C},null,8,["loading"])]),u("div",null,[t(o,{ui:{description:"text-xs"},variant:"soft",description:"Uploaded ID must be in image or PDF format and should not exceed 2MB"})])])]),_:1})])):e(n).profile.kycStatus==="verified"?(c(),m("div",oe,[t(s,{class:"md:w-[30rem]"},{default:r(()=>[t(o,{title:"KYC Verification",description:"Your data has been verified.",icon:"i-lucide-alert-circle",variant:"subtle",ui:{actions:"justify-end"},actions:[{label:"Donwload",size:"md",onClick:()=>{w()}}]},null,8,["actions"])]),_:1})])):g("",!0):(c(),m("div",J,[t(s,{class:"max-w-[30rem]"},{header:r(()=>a[3]||(a[3]=[u("p",{class:"card-title"},"Upload a valid government-issued ID",-1)])),default:r(()=>[u("div",O,[e(d)?(c(),y(I,{key:0,title:e(d).name,message:e(d).message},null,8,["title","message"])):g("",!0),u("div",G,[t(T,{modelValue:e(l).governmentIdType,"onUpdate:modelValue":a[0]||(a[0]=_=>e(l).governmentIdType=_),items:x,size:"lg",placeholder:"Select ID type",class:"w-full"},null,8,["modelValue"]),t(D,{type:"file",size:"lg",class:"w-full",accept:"image/*,.pdf",onChange:b}),t(V,{size:"lg",label:"Submit",icon:"i-lucide-check-circle",loading:e(f),onClick:C},null,8,["loading"])]),u("div",null,[t(o,{ui:{description:"text-xs"},variant:"soft",description:"Uploaded ID must be in image or PDF format and should not exceed 2MB"})])])]),_:1})])):(c(),m("div",H,[t(s,null,{default:r(()=>[t(o,{title:"KYC Verification",description:"Please update your profile to continue",icon:"i-lucide-alert-circle",class:"md:w-[30rem]",variant:"subtle",ui:{actions:"justify-end"},actions:[{label:"Proceed",size:"md",onClick:()=>{("navigateTo"in i?i.navigateTo:e(z))("/user/profile")}}]},null,8,["actions"])]),_:1})]))])):g("",!0)]),_:1},8,["error"])}}});export{Ce as default};
