import{_ as K}from"./DbqLP4vC.js";import{l as O,R as Q,P as s,E as $,m as W,X as Z,f as ee,Y as te,c,a as _,J as w,n as a,b as n,w as h,U as C,F as oe,x as ae,r as ne,o as l,t as le,H as ie,y as se}from"./BCrY3s8v.js";import{_ as ce}from"./ZpX6fDX3.js";import{_ as re}from"./Cs8bg_jY.js";import{_ as ue}from"./CqYo-uwL.js";import{_ as de}from"./DkVdtwoL.js";import{_ as me}from"./bl0oUpIY.js";import{_ as fe}from"./CidxsHgk.js";import{u as pe}from"./IDdVFqQ_.js";import{n as D}from"./wc51SthY.js";import{u as _e}from"./mHVIAYtm.js";import"./CHIgUVhi.js";import"./C2XZIq7O.js";import"./8tY1C0Fy.js";import"./ZB12-UxD.js";import"./YE4bf-b6.js";import"./CtXVfFFE.js";import"./CpLtEdiG.js";import"./1c9ch5oL.js";import"./DSCz-RR9.js";import"./Df43cr2Y.js";import"./D3Ilbq-7.js";import"./BsY6ekDi.js";import"./kRIii9yh.js";import"./DGxpg-Ox.js";import"./Bar4WUZu.js";import"./CZ2Yaa7T.js";import"./D8mweQSH.js";import"./Cn5wymF0.js";import"./CSISanO2.js";import"./BA4GzNlT.js";import"./CwNR5WVR.js";const ve={class:"space-y-4"},he={class:"flex items-center gap-4 justify-end"},ye={key:0,class:"flex items-center"},ke={key:0},ge={class:"space-y-4"},xe={class:"flex items-center gap-2 justify-end"},we={key:1},Ne={ref:"srcollDiv",class:"max-h-[calc(100dvh-15rem)] overlow-y-auto space-y-4"},be={key:0,class:"space-y-4"},Re={key:1},$e={key:2,class:"flex-center"},Ce={key:3},I=20,st=O({__name:"notifications",setup(De){const A=Q(),U=_e().getParams("accountId"),V=s([[{label:"All",onSelect:()=>x("All")},{label:"Read",onSelect:()=>x("Read")},{label:"Unread",onSelect:()=>x("Unread")}]]),o=s([]),m=$(()=>o.value.filter(e=>e.checked===!0).map(e=>e.id)),y=s([]),k=s(!1),S=$(()=>o.value.length),f=s(!1),v=s(null);async function g(){if(!(f.value||k.value)){v.value=null,f.value=!0;try{const e=await $fetch(`/api/user/financial-accounts/${U}/notifications`,{params:{skip:S.value,limit:I}});o.value=[...o.value,...e],e.length<I&&(k.value=!0)}catch(e){v.value=D(e)}finally{f.value=!1}}}const E=W("srcollDiv"),{reset:B}=pe(E,async()=>{await g()},{distance:20,canLoadMore:()=>k.value});async function b(){o.value=[],k.value=!1,B(),await g()}const i=s(!1);Z(m,()=>i.value=m.value.length>0);function x(e){e==="All"&&(o.value=o.value.map(t=>({...t,checked:!0}))),e==="Read"&&(o.value=o.value.map(t=>({...t,checked:t.isRead}))),e==="Unread"&&(o.value=o.value.map(t=>({...t,checked:!t.isRead})))}const F=(e,t)=>{o.value=o.value.map(r=>({...r,checked:r.id===e?t:r.checked}))};function M(){i.value=!1,o.value=o.value.map(e=>({...e,checked:!1}))}function z(e){e.target.getAttribute("data-state")==="unchecked"?(i.value=!0,x("All")):(i.value=!1,M())}function T(e){o.value=o.value.filter(t=>t.id!==e)}function j(e){const t=o.value.find(r=>r.id===e);t&&!t.isRead&&(y.value=[...y.value,t.id])}async function L(){if(y.value.length)try{await $fetch("/api/user/notifications",{method:"put",body:{notifications:y.value}})}catch(e){console.error(e)}}const d=s(!1),N=s(!1);async function P(){if(!m.value.length){d.value=!1;return}N.value=!0;try{await $fetch("/api/user/notifications",{method:"patch",body:{notifications:m.value}}),o.value=o.value.filter(e=>!m.value.includes(e.id)),b()}catch(e){A.add({color:"error",title:"Error",description:D(e).message})}finally{N.value=!1,d.value=!1}}return ee(async()=>{await g()}),te(()=>{L()}),(e,t)=>{const r=K,p=ne,H=ce,R=re,J=ue,X=de,Y=me,q=se,G=fe;return l(),c("div",null,[_("div",ve,[_("header",he,[a(o).length?(l(),c("div",ye,[n(p,{color:"neutral",variant:a(i)?"soft":"link",class:""},{default:h(()=>[n(r,{modelValue:a(i),"onUpdate:modelValue":t[0]||(t[0]=u=>C(i)?i.value=u:null),onClick:z},null,8,["modelValue"]),n(H,{items:a(V)},{default:h(()=>[n(p,{size:"sm",color:"neutral",variant:"link",icon:"lucide:chevron-down"})]),_:1},8,["items"])]),_:1},8,["variant"]),a(i)?(l(),c("div",ke,[n(R,{text:"Delete selected"},{default:h(()=>[n(p,{icon:"lucide:trash",color:"neutral",variant:"link",loading:a(N),onClick:t[1]||(t[1]=u=>d.value=!0)},null,8,["loading"])]),_:1}),n(J,{open:a(d),"onUpdate:open":t[3]||(t[3]=u=>C(d)?d.value=u:null),title:"Delete notifications"},{body:h(()=>[_("div",ge,[_("p",null," Are you sure you want to delete these "+le(a(m).length)+" notification(s)? ",1),_("div",xe,[n(p,{label:"Cancel",color:"neutral",variant:"soft",onClick:t[2]||(t[2]=u=>d.value=!1)}),n(p,{label:"Delete",color:"error","loading-auto":"",onClick:P})])])]),_:1},8,["open"])])):(l(),c("div",we,[n(R,{text:"Refresh"},{default:h(()=>[n(p,{icon:"lucide:rotate-cw",color:"neutral",variant:"link",loading:a(f),onClick:b},null,8,["loading"])]),_:1})]))])):w("",!0)]),_("div",Ne,[a(o).length>0?(l(),c("div",be,[(l(!0),c(oe,null,ae(a(o),u=>(l(),ie(X,{key:u.id,notification:u,onUpdated:F,onDeleted:T,onVisible:j},null,8,["notification"]))),128))])):w("",!0),!a(f)&&!a(v)&&a(o).length===0?(l(),c("div",Re,[n(Y,{label:"No notifications"})])):w("",!0),a(f)?(l(),c("div",$e,[n(q,{name:"lucide:loader",size:"2rem",class:"animate animate-spin"})])):a(v)?(l(),c("div",Ce,[n(G,{message:a(v).message,"show-retry":"",onRetry:g},null,8,["message"])])):w("",!0)],512)])])}}});export{st as default};
