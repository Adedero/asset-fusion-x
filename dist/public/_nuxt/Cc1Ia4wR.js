import{_ as G}from"./DbqLP4vC.js";import{l as K,R as O,P as s,E as R,m as Q,X as W,f as Z,Y as ee,c,a as m,J as b,n as a,b as n,w as h,U as $,F as te,x as oe,r as ae,o as l,t as ne,H as le,y as ie}from"./BCrY3s8v.js";import{_ as se}from"./ZpX6fDX3.js";import{_ as ce}from"./Cs8bg_jY.js";import{_ as re}from"./CqYo-uwL.js";import{_ as ue}from"./DkVdtwoL.js";import{_ as de}from"./bl0oUpIY.js";import{_ as me}from"./CidxsHgk.js";import{u as fe}from"./IDdVFqQ_.js";import{n as A}from"./wc51SthY.js";import"./CHIgUVhi.js";import"./C2XZIq7O.js";import"./8tY1C0Fy.js";import"./ZB12-UxD.js";import"./YE4bf-b6.js";import"./CtXVfFFE.js";import"./CpLtEdiG.js";import"./1c9ch5oL.js";import"./DSCz-RR9.js";import"./Df43cr2Y.js";import"./D3Ilbq-7.js";import"./BsY6ekDi.js";import"./kRIii9yh.js";import"./DGxpg-Ox.js";import"./Bar4WUZu.js";import"./CZ2Yaa7T.js";import"./D8mweQSH.js";import"./Cn5wymF0.js";import"./CSISanO2.js";import"./BA4GzNlT.js";import"./CwNR5WVR.js";const pe={class:"space-y-4"},_e={class:"flex items-center gap-4 justify-between"},ve={key:0,class:"flex items-center"},he={key:0},ye={class:"space-y-4"},ke={class:"flex items-center gap-2 justify-end"},ge={key:1},xe={ref:"srcollDiv",class:"max-h-[calc(100dvh-10rem)] overlow-y-auto space-y-4"},be={key:0,class:"space-y-4"},we={key:1},Ne={key:2,class:"flex-center"},Ce={key:3},D=20,nt=K({__name:"index",setup(Re){const U=O(),I=s([[{label:"All",onSelect:()=>x("All")},{label:"Read",onSelect:()=>x("Read")},{label:"Unread",onSelect:()=>x("Unread")}]]),o=s([]),f=R(()=>o.value.filter(e=>e.checked===!0).map(e=>e.id)),y=s([]),k=s(!1),V=R(()=>o.value.length),p=s(!1),v=s(null);async function g(){if(!(p.value||k.value)){v.value=null,p.value=!0;try{const e=await $fetch("/api/user/notifications",{params:{skip:V.value,limit:D}});o.value=[...o.value,...e],e.length<D&&(k.value=!0)}catch(e){v.value=A(e)}finally{p.value=!1}}}const S=Q("srcollDiv"),{reset:E}=fe(S,async()=>{await g()},{distance:20,canLoadMore:()=>k.value});async function N(){o.value=[],k.value=!1,E(),await g()}const i=s(!1);W(f,()=>i.value=f.value.length>0);function x(e){e==="All"&&(o.value=o.value.map(t=>({...t,checked:!0}))),e==="Read"&&(o.value=o.value.map(t=>({...t,checked:t.isRead}))),e==="Unread"&&(o.value=o.value.map(t=>({...t,checked:!t.isRead})))}const B=(e,t)=>{o.value=o.value.map(r=>({...r,checked:r.id===e?t:r.checked}))};function F(){i.value=!1,o.value=o.value.map(e=>({...e,checked:!1}))}function M(e){e.target.getAttribute("data-state")==="unchecked"?(i.value=!0,x("All")):(i.value=!1,F())}function z(e){o.value=o.value.filter(t=>t.id!==e)}function T(e){const t=o.value.find(r=>r.id===e);t&&!t.isRead&&(y.value=[...y.value,t.id])}async function j(){if(y.value.length)try{await $fetch("/api/user/notifications",{method:"put",body:{notifications:y.value}})}catch(e){console.error(e)}}const d=s(!1),w=s(!1);async function L(){if(!f.value.length){d.value=!1;return}w.value=!0;try{await $fetch("/api/user/notifications",{method:"patch",body:{notifications:f.value}}),o.value=o.value.filter(e=>!f.value.includes(e.id)),N()}catch(e){U.add({color:"error",title:"Error",description:A(e).message})}finally{w.value=!1,d.value=!1}}return Z(async()=>{await g()}),ee(()=>{j()}),(e,t)=>{const r=G,_=ae,H=se,C=ce,J=re,P=ue,X=de,Y=ie,q=me;return l(),c("div",null,[m("div",pe,[m("header",_e,[t[4]||(t[4]=m("div",{class:"text-xl font-semibold"},"Notifications",-1)),a(o).length?(l(),c("div",ve,[n(_,{color:"neutral",variant:a(i)?"soft":"link",class:""},{default:h(()=>[n(r,{modelValue:a(i),"onUpdate:modelValue":t[0]||(t[0]=u=>$(i)?i.value=u:null),onClick:M},null,8,["modelValue"]),n(H,{items:a(I)},{default:h(()=>[n(_,{size:"sm",color:"neutral",variant:"link",icon:"lucide:chevron-down"})]),_:1},8,["items"])]),_:1},8,["variant"]),a(i)?(l(),c("div",he,[n(C,{text:"Delete selected"},{default:h(()=>[n(_,{icon:"lucide:trash",color:"neutral",variant:"link",loading:a(w),onClick:t[1]||(t[1]=u=>d.value=!0)},null,8,["loading"])]),_:1}),n(J,{open:a(d),"onUpdate:open":t[3]||(t[3]=u=>$(d)?d.value=u:null),title:"Delete notifications"},{body:h(()=>[m("div",ye,[m("p",null," Are you sure you want to delete these "+ne(a(f).length)+" notification(s)? ",1),m("div",ke,[n(_,{label:"Cancel",color:"neutral",variant:"soft",onClick:t[2]||(t[2]=u=>d.value=!1)}),n(_,{label:"Delete",color:"error","loading-auto":"",onClick:L})])])]),_:1},8,["open"])])):(l(),c("div",ge,[n(C,{text:"Refresh"},{default:h(()=>[n(_,{icon:"lucide:rotate-cw",color:"neutral",variant:"link",loading:a(p),onClick:N},null,8,["loading"])]),_:1})]))])):b("",!0)]),m("div",xe,[a(o).length>0?(l(),c("div",be,[(l(!0),c(te,null,oe(a(o),u=>(l(),le(P,{key:u.id,notification:u,onUpdated:B,onDeleted:z,onVisible:T},null,8,["notification"]))),128))])):b("",!0),!a(p)&&!a(v)&&a(o).length===0?(l(),c("div",we,[n(X,{label:"No notifications"})])):b("",!0),a(p)?(l(),c("div",Ne,[n(Y,{name:"lucide:loader",size:"2rem",class:"animate animate-spin"})])):a(v)?(l(),c("div",Ce,[n(q,{message:a(v).message,"show-retry":"",onRetry:g},null,8,["message"])])):b("",!0)],512)])])}}});export{nt as default};
